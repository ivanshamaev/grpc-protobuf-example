# grpc-protobuf-example
–ü–æ–ª–Ω—ã–π –≥–∞–π–¥: gRPC + ProtoBuf + Python + Docker

–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ Python —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **gRPC** –∏ **ProtoBuf**.  
–ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –∏ –∫–ª–∏–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–µ –æ–±–º–µ–Ω–∏–≤–∞—é—Ç—Å—è –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏: –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–º—è, —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ.

![–°—Ö–µ–º–∞ –ø—Ä–æ–µ–∫—Ç–∞](doc/gRPC_client_server.jpg)


## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

| –ü—É—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---|---|
| `proto/hello.proto` | –û–ø–∏—Å–∞–Ω–∏–µ ProtoBuf: —Å–æ–æ–±—â–µ–Ω–∏—è `HelloRequest`, `HelloReply` –∏ —Å–µ—Ä–≤–∏—Å `Greeter` —Å –º–µ—Ç–æ–¥–æ–º `SayHello`. |
| `server/` | –ö–æ–¥ —Å–µ—Ä–≤–µ—Ä–∞. |
| `server/hello_pb2.py` | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–ª–∞—Å—Å—ã —Å–æ–æ–±—â–µ–Ω–∏–π (–∏–∑ `.proto`) –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞. |
| `server/hello_pb2_grpc.py` | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞, –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å —Å–µ—Ä–≤–∏—Å–∞ –∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. |
| `server/server.py` | –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä: —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞, –∑–∞–ø—É—Å–∫ gRPC-—Å–µ—Ä–≤–µ—Ä–∞, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ. |
| `client/` | –ö–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞. |
| `client/hello_pb2.py` | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞. |
| `client/hello_pb2_grpc.py` | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ stub-–∫–ª–∞—Å—Å—ã –¥–ª—è –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞. |
| `client/client.py` | –û—Å–Ω–æ–≤–Ω–æ–π –∫–ª–∏–µ–Ω—Ç: —Å–æ–∑–¥–∞—ë—Ç –∫–∞–Ω–∞–ª, stub, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –∏ –ª–æ–≥–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç. |
| `requirements.txt` | Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ (`grpcio`, `grpcio-tools`, `protobuf`). |
| `Dockerfile` | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å–±–æ—Ä–∫–∏ Docker-–æ–±—Ä–∞–∑–∞ –¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞/–∫–ª–∏–µ–Ω—Ç–∞. |
| `docker-compose.yml` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Docker Compose –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Äa –∏ –∫–ª–∏–µ–Ω—Ç–∞ —Å —Å–µ—Ç—å—é. |
| `.gitignore` | –ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, `venv/`, `__pycache__/` –∏ –¥—Ä. |
| `README.md` | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞. |



# venv
```
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install --no-cache-dir -r requirements.txt
```

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Python-–∫–æ–¥–∞ –∏–∑ .proto
–ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–º–∞–Ω–¥—É (–º–æ–∂–Ω–æ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–ª–∏ –Ω–∞ —Å–≤–æ–µ–π –º–∞—à–∏–Ω–µ):
```
python -m grpc_tools.protoc -I=./proto --python_out=./server --grpc_python_out=./server ./proto/hello.proto
python -m grpc_tools.protoc -I=./proto --python_out=./client --grpc_python_out=./client ./proto/hello.proto
```

# –ó–∞–ø—É—Å–∫–∞–µ–º –ª–æ–∫–∞–ª—å–Ω–æ (–±–µ–∑ Docker) —Å–µ—Ä–≤–µ—Ä –∏ –∫–ª–∏–µ–Ω—Ç –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –ø–æ—Ä—Ç–∞—Ö

## –ó–∞–ø—É—Å–∫–∞–µ–º —Å–µ—Ä–≤–µ—Ä
```
python server/server.py
```
–í –∫–æ–Ω—Å–æ–ª–∏ –ø–æ–ª—É—á–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
[SERVER] gRPC —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 50051
```

## –ó–∞–ø—É—Å–∫–∞–µ–º –∫–ª–∏–µ–Ω—Ç (—É–π–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É)
–î–ª—è –∫–ª–∏–µ–Ω—Ç–∞ –≤ —Ñ–∞–π–ª–µ `client/client.py` –Ω—É–∂–Ω–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `host` —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
```
host='localhost'
```

–ó–∞–ø—É—Å–∫–∞–µ–º –∫–ª–∏–µ–Ω—Ç –∫–æ–º–∞–Ω–¥–æ–π:
```
python client/client.py
```

## –õ–æ–≥ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∫–ª–∏–µ–Ω—Ç–∞
–°–µ—Ä–≤–µ—Ä –¥–∞—Å—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—É—Å–∫ –∫–ª–∏–µ–Ω—Ç–∞:
```
[SERVER] –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å: name=Python Junior
[SERVER] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç: –ü—Ä–∏–≤–µ—Ç, Python Junior!
```

–ö–ª–∏–µ–Ω—Ç –≤—ã–≤–µ–¥–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ:
```
[CLIENT] –°–æ–∑–¥–∞—ë–º –∫–∞–Ω–∞–ª –∫ —Å–µ—Ä–≤–µ—Ä—É...
[CLIENT] Stub —Å–æ–∑–¥–∞–Ω. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...
[CLIENT] –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç: –ü—Ä–∏–≤–µ—Ç, Python Junior!
```

# –ó–∞–ø—É—Å–∫ —Å –¥–æ–∫–µ—Ä–æ–º
–°–æ–±–∏—Ä–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã:
```
docker compose build
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
```
[+] Building 2/2
 ‚úî client  Built
 ‚úî server  Built 
```

–ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```
docker compose up
```

# –†–µ–∑—É–ª—å—Ç–∞—Ç

```
[+] Running 3/3
 ‚úî Network grpc-protobuf-example_custom_net  Created                                                                            0.1s 
 ‚úî Container grpc_server                     Created                                                                            0.2s 
 ‚úî Container grpc_client                     Created                                                                            0.2s 
Attaching to grpc_client, grpc_server
grpc_server  | [SERVER] gRPC —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 50051
grpc_client  | [CLIENT] –°–æ–∑–¥–∞—ë–º –∫–∞–Ω–∞–ª –∫ server:50051...
grpc_client  | [CLIENT] Stub —Å–æ–∑–¥–∞–Ω. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å...
grpc_server  | [SERVER] –ü–æ–ª—É—á–µ–Ω –∑–∞–ø—Ä–æ—Å: name=Python Junior
grpc_server  | [SERVER] –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç: –ü—Ä–∏–≤–µ—Ç, Python Junior!
grpc_client  | [CLIENT] –ü–æ–ª—É—á–µ–Ω –æ—Ç–≤–µ—Ç: –ü—Ä–∏–≤–µ—Ç, Python Junior!
```

## –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã docker compose
### –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã –∏ —É–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```
docker compose down
```

### –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã + —Å–µ—Ç–∏ + volumes –ø—Ä–æ–µ–∫—Ç–∞
```
docker compose down -v
```

### –£–¥–∞–ª–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã + —Å–µ—Ç–∏ + volumes + —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã
```
docker compose down --rmi all -v
```
